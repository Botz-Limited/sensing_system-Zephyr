# MCUBoot configuration for nRF5340 with external flash
CONFIG_MCUBOOT_LOG_LEVEL_WRN=y
CONFIG_SIZE_OPTIMIZATIONS=n

# Boot strategy - use swap mode for reliability
CONFIG_BOOT_UPGRADE_ONLY=n
CONFIG_MCUBOOT_DOWNGRADE_PREVENTION=n

# External flash configuration
CONFIG_NORDIC_QSPI_NOR=y
CONFIG_PM_EXTERNAL_FLASH_MCUBOOT_SECONDARY=y
CONFIG_FLASH=y
CONFIG_FPROTECT=n

# Multi-image update support
CONFIG_PCD_APP=y
CONFIG_FLASH_SIMULATOR=y
CONFIG_FLASH_SIMULATOR_DOUBLE_WRITES=n
CONFIG_FLASH_SIMULATOR_STATS=n

# nRF5340 specific
CONFIG_NRF53_MULTI_IMAGE_UPDATE=y
CONFIG_UPDATEABLE_IMAGE_NUMBER=2

# Image access hooks for nRF5340
CONFIG_BOOT_IMAGE_ACCESS_HOOK_NRF5340=y
CONFIG_BOOT_IMAGE_ACCESS_HOOKS=y

# Ensure proper reset handling
CONFIG_BOOT_DIRECT_XIP=n
CONFIG_BOOT_BOOTSTRAP=n

# Increase scratch area size if using swap mode
CONFIG_BOOT_SWAP_SAVE_ENCTLV=n